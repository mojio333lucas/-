<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§è¨˜æ†¶æœ¬è‰æ¸¬é©— (æœŸæœ«æœ¬è‰)</title>
    <style>
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background-color: #f4f7f6; padding: 20px; text-align: center; margin: 0; }
        .container { background: white; max-width: 600px; margin: 0 auto; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #2e7d32; margin-bottom: 5px; }
        .sub-title { color: #666; font-size: 0.9rem; margin-bottom: 15px; }
        
        .strategy-bar { background: #fff3e0; padding: 10px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #ffe0b2; font-size: 0.95rem; }
        .strategy-bar label { margin: 0 10px; cursor: pointer; color: #e65100; font-weight: bold; display: inline-block; }
        .strategy-bar input { margin-right: 5px; }
        #pool-info { font-size: 0.85rem; color: #d84315; margin-top: 5px; font-weight: bold; min-height: 1.2em; }

        .memory-bar { display: flex; justify-content: space-around; background: #f1f8e9; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 0.8rem; color: #555; }
        .mem-item span { display: block; font-weight: bold; font-size: 1.1rem; color: #d32f2f; }

        .mode-bar { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #ccc; }
        .mode-btn { background: #e0e0e0; color: #333; border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 0.85rem; transition: 0.3s; }
        .mode-btn.active { background: #2e7d32; color: white; font-weight: bold; }

        .question-box { background: #e8f5e9; padding: 20px; border-radius: 10px; min-height: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center; margin-bottom: 20px; }
        .q-tag { background: #2e7d32; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; margin-bottom: 5px; display: inline-block; }
        .q-text { font-size: 1.2rem; font-weight: bold; color: #1b5e20; line-height: 1.4; }
        
        .options { display: grid; gap: 10px; }
        .opt-btn { background: white; border: 2px solid #2e7d32; color: #2e7d32; padding: 12px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: 0.2s; }
        .opt-btn:hover { background: #e8f5e9; }
        .opt-btn.correct { background: #4caf50; color: white; border-color: #4caf50; }
        .opt-btn.wrong { background: #f44336; color: white; border-color: #f44336; }
        
        .control-area { margin-top: 20px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .ctrl-btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; margin: 5px; }
        #next-btn { background: #333; display: none; }
        #end-btn { background: #d32f2f; }
        #reset-mem-btn { background: #607d8b; font-size: 0.8rem; margin-top: 10px; padding: 5px 10px; color: white; border: none; border-radius: 5px; cursor: pointer; }

        #review-section { display: none; text-align: left; }
        .review-item { border-bottom: 1px solid #eee; padding: 10px 0; }
        .review-q { font-weight: bold; color: #333; margin-bottom: 5px; }
        .review-wrong { color: #d32f2f; font-size: 0.9rem; }
        .review-correct { color: #2e7d32; font-size: 0.9rem; font-weight: bold; }
        
        /* æŒ‰éˆ•å€åˆ† */
        #restart-btn { width: 100%; margin-top: 10px; background: #2e7d32; padding: 15px; color: white; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; }
        #review-wrong-btn { width: 100%; margin-top: 20px; background: #ff9800; padding: 15px; color: white; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; display: none; box-shadow: 0 4px 0 #e65100; }
        #review-wrong-btn:active { transform: translateY(4px); box-shadow: none; }

        #error-msg { color: red; font-size: 0.8rem; display: none; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container" id="quiz-container">
    <h2>ğŸ§  æ™ºæ…§è¨˜æ†¶æœ¬è‰æ¸¬é©—</h2>
    <div class="sub-title">å¾—åˆ†: <span id="score">0</span> | é¡Œæ•¸: <span id="count">0</span></div>

    <div class="strategy-bar">
        å‡ºé¡Œæ¨¡å¼ï¼š<br>
        <label><input type="radio" name="strategy" value="once" checked onchange="handleStrategyChange()"> ğŸ åœ°æ¯¯å¼å…¨è·‘</label>
        <label><input type="radio" name="strategy" value="repeat" onchange="handleStrategyChange()"> ğŸ” éš¨æ©Ÿç„¡é™è¤‡ç¿’</label>
        <div id="pool-info"></div>
    </div>

    <div class="memory-bar">
        <div class="mem-item">ç§‘åæ¬Šé‡<span id="w-family">1</span></div>
        <div class="mem-item">ç”Ÿè—¥æ¬Šé‡<span id="w-drug">1</span></div>
        <div class="mem-item">å­¸åæ¬Šé‡<span id="w-sci">1</span></div>
        <div class="mem-item">å‚™è¨»æ¬Šé‡<span id="w-note">1</span></div>
    </div>
    <div id="error-msg">âš ï¸ ç„¡æ³•å­˜å–è¨˜æ†¶ï¼ˆç·šä¸Šé è¦½æ¨¡å¼ï¼‰ï¼Œæœ¬æ¬¡ç´€éŒ„ä¸æœƒä¿å­˜ã€‚</div>

    <div class="mode-bar">
        <button class="mode-btn active" onclick="setMode('mix', this)">ğŸ”€ æ™ºæ…§ç¶œåˆ</button>
        <button class="mode-btn" onclick="setMode('family', this)">ğŸŒ± ç§‘å</button>
        <button class="mode-btn" onclick="setMode('drug', this)">ğŸ’Š ç”Ÿè—¥å</button>
        <button class="mode-btn" onclick="setMode('sci', this)">ğŸ”¬ å­¸å</button>
        <button class="mode-btn" onclick="setMode('note', this)">ğŸ“ å‚™è¨»</button>
    </div>

    <div class="question-box">
        <div class="q-tag" id="q-tag">è¼‰å…¥ä¸­</div>
        <div class="q-text" id="question">æº–å‚™é–‹å§‹...</div>
    </div>

    <div class="options" id="options-area"></div>
    
    <div class="control-area">
        <button class="ctrl-btn" id="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â–¶</button>
        <button class="ctrl-btn" id="end-btn" onclick="endQuiz()">ğŸ“Š çµç®—</button>
    </div>
    
    <button id="reset-mem-btn" onclick="resetMemory()">â™»ï¸ æ¸…é™¤è¨˜æ†¶ (é‡ç½®å‡ºé¡Œæ©Ÿç‡)</button>
</div>

<div class="container" id="review-section">
    <h2>ğŸ“Š æ¸¬é©—çµç®—</h2>
    <p>æœ¬æ¬¡å¾—åˆ†ï¼š<span id="final-score" style="font-weight:bold; color:#2e7d32; font-size:1.5rem;"></span></p>
    
    <button id="review-wrong-btn" onclick="startReviewWrong()">ğŸ¯ ç«‹å³è¤‡ç¿’æœ¬è¼ªéŒ¯é¡Œ</button>
    
    <hr>
    <h3>âŒ æœ¬è¼ªéŒ¯é¡Œç´€éŒ„ï¼š</h3>
    <div id="wrong-list"></div>
    
    <button id="restart-btn" onclick="restartQuiz()">ğŸ”„ é‡æ–°é–‹å§‹å®Œæ•´æ¸¬é©—</button>
</div>

<script>
    const db = [
        {name:"çŸ¥æ¯", family:"Liliaceae", drug:"Anemarrhenae Rhizoma", sci:"Anemarrhena asphodeloides", note:"å« saponin (çš‚ç´ )"},
        {name:"ç”˜è‰", family:"Fabaceae/Leguminosae", drug:"Glycyrrhizae Radix", sci:"Glycyrrhiza uralensis", note:"åœ‹è€ã€å« Glycyrrhizin-æœˆäº®è‡‰"},
        {name:"é»ƒé€£", family:"Ranunculaceae", drug:"Coptidis Rhizoma", sci:"Coptis chinensis", note:"berberineã€ç„¡ saponinã€æ ¹å¦‚é€£ç "},
        {name:"å·èŠ", family:"Apiaceae/Umbelliferae", drug:"Chuanxiong Rhizoma", sci:"Ligusticum chuanxiong", note:"ç„¡ Saponin"},
        {name:"ä½•é¦–çƒ", family:"Polygonaceae", drug:"Polygoni Multiflori Radix", sci:"Polygonum multiflorum", note:"é›²éŒ¦èŠ±ç´‹ç‚ºç•°å¸¸ç¶­ç®¡æŸã€é¦¬è‚çŸ³ã€æœ‰ç€‰ä¸‹ã€å¼·å£¯ã€ç·©ä¸‹ä½œç”¨ã€åŒ–å­¸çµæ§‹-æŠ—æ°§åŒ–åŠ‘(é–“)"},
        {name:"åœ°é»ƒ", family:"Scrophulariaceae", drug:"Rehmanniae Radix", sci:"Rehmannia glutinosa", note:"æ‡·æ…¶åœ°é»ƒ"},
        {name:"ç´°è¾›", family:"Aristolochiaceae", drug:"Asiasari Radix", sci:"Asarum sieboldii", note:"å–®ç”¨ä¸å¯éåŠéŒ¢åŒ•"},
        {name:"ç™½é ­ç¿", family:"Ranunculaceae", drug:"Pulsatillae Radix", sci:"Pulsatilla chinensis", note:"å« saponin"},
        {name:"åœŸèŒ¯è‹“", family:"Liliaceae", drug:"Smilacis Glabrae Rhizoma", sci:"Smilax glabra", note:"åˆºè±¬è‹“ã€å« saponinã€diosgenin"},
        {name:"èŒ¯è‹“", family:"Polyporaceae", drug:"Poria", sci:"èŒ¯è‹“èŒ Pachyma hoelen/èŒ¯è‹“Poria cocos", note:"èŒæ ¸ã€ä¹…æœå®‰é­‚ã€é¤Šç¥ã€åƒå¹´ä¹‹æ¾"},
        {name:"é¦¬å‹ƒ", family:"Lycoperdaceae", drug:"puffballs", sci:"Calvatia gigantea", note:"é¦¬å±åŒ…"},
        {name:"ç‰›é»ƒ", family:"Bovidae", drug:"Bezoar Bovis", sci:"Bos taurus", note:"ç‰›è†½å›Šä¸­çš„çµçŸ³"},
        {name:"é‡‘éŠ€èŠ±", family:"Caprifoliaceae", drug:"Lonicerae Flos", sci:"Lonicera japonica", note:"å¿å†¬-å‡Œå†¬ä¸å‡‹"},
        {name:"æ´‹é‡‘èŠ±", family:"Solanaceae", drug:"Daturae Flos", sci:"ç™½èŠ±å—Datura metel/æ¯›åŒ—Datura innoxia Mill", note:"éº»æ²¸æ•£ã€Tropane alkaloids"},
        {name:"ç›Šæ¯è‰", family:"Lamiaceae/Labiatae", drug:"Leonuri Herba", sci:"Leonurus heterophyllus", note:"å……è”š(æœå¯¦)"},
        {name:"é­šè…¥è‰", family:"Saururaceae", drug:"Houttuyniae Herba", sci:"Houttuynia cordata", note:"è•ºèœ"},
        {name:"éº»é»ƒ", family:"Ephedraceae", drug:"Ephedrae Herba", sci:"æœ¨è³Šéº»é»ƒEphedra equisetina/è‰(å·)éº»é»ƒEphedra sinica", note:"ç™¼æ±—è§£ç†±ã€å« Ephedrine(æ”¯æ°£ç®¡æ“´å¼µ)ã€è£¸å­æ¤ç‰©"},
        {name:"å…«è§’èŒ´é¦™", family:"Magnoliaceae", drug:"Anisi Stellati Fructus", sci:"Illicium verum", note:"å« Anetholeã€æ®ç™¼æ²¹"},
        {name:"æ±ºæ˜å­", family:"Fabaceae/Leguminosae", drug:"Cassiae Semen", sci:"æ±ºæ˜Cassia obtusifolia/å°æ±ºæ˜Cassia tora ", note:"å­å½¢ä¼¼é¦¬è¹„ã€æœ‰ç€‰ä¸‹åŠŸç”¨"},
        {name:"è»Šå‰è‰", family:"Plantaginaceae", drug:"Plantaginis Herba", sci:"Plantago asiatica", note:"åœ°è¡£"},
        {name:"èƒ¡æ¤’", family:"Piperaceae", drug:"Piperis Nigri Fructus", sci:"Piper nigrum", note:"èƒ¡æ¤’æœ"},
        {name:"è›‡åºŠå­", family:"Apiaceae/Umbelliferae", drug:"Cnidii Fructus", sci:"Cnidium monnieri", note:"æ²»é™½ç—¿ã€å®®å†·ä¸å­•ã€é€£é™½å…«åº§"},
        {name:"æª³æ¦”å­", family:"Arecaceae/Palmae", drug:"Arecae Semen", sci:"Areca catechu", note:"å« Arecoline (æª³æ¦”é¹¼)ã€èŠ±æª³æ¦”-éŒ¯å…¥çµ„ç¹”"},
        {name:"æœä»²", family:"Eucommiaceae", drug:"Eucommiae Cortex", sci:"Eucommia ulmoides", note:"æ²’æœ‰ç€‰ä¸‹ã€æŠ˜æ–·æœ‰çµ²ã€ä¸€ç§‘ä¸€å±¬ã€é›Œé›„ç•°æ ªã€æ¨¹çš®å¼·å£¯è—¥"},
        {name:"åšæœ´", family:"Magnoliaceae", drug:"Magnoliae Cortex", sci:"åšæœ´Magnolia officinalis/å‡¹è‘‰åšæœ´Magnolia biloba", note:"è—¥ç”¨éƒ¨åˆ†æ˜¯è–çš®(ä¹¾ç‡¥æ¨¹çš®)ã€çƒˆèµ¤ã€lignans and alkaloid"},
        {name:"æ¡‚çš®", family:"Lauraceae", drug:"Cinnamomi Cortex", sci:"Cinnamomum cassia", note:"è‚‰æ¡‚ã€å« Cinnamaldehyde"},
        {name:"é»ƒæŸ", family:"Rutaceae", drug:"Phellodendri Cortex", sci:"é—œé»ƒæŸPhellodendron amurense/å·é»ƒæŸPhellodendron chinense", note:"å« Berberineã€è‹¦å‘³å¥èƒƒã€è·Œæ‰“æå‚·è—¥ã€è˜—æœ¨(æœ¬ç¶“)ã€é»ƒè˜—(æœ¬è‰ç¶“é›†è‘—"}
    ];

    let currentMode = 'mix';
    let score = 0, count = 0;
    let canAnswer = true;
    let wrongLog = [];
    let currentQData = {};
    let weights = { family: 1, drug: 1, sci: 1, note: 1 };
    let questionPool = []; 
    let currentDbIndex = 0; // è¿½è¹¤ç›®å‰é¡Œç›®åœ¨ db çš„ index
    let sessionWrongIndices = []; // ç´€éŒ„æœ¬è¼ªç­”éŒ¯çš„ db index

    function initWeights() {
        try {
            let saved = localStorage.getItem('quizWeights');
            if (saved) weights = JSON.parse(saved);
        } catch (e) {
            document.getElementById('error-msg').style.display = 'block';
        }
        updateWeightDisplay();
    }

    function saveWeights() {
        try { localStorage.setItem('quizWeights', JSON.stringify(weights)); } catch (e) {}
        updateWeightDisplay();
    }

    function updateWeightDisplay() {
        document.getElementById('w-family').innerText = weights.family;
        document.getElementById('w-drug').innerText = weights.drug;
        document.getElementById('w-sci').innerText = weights.sci;
        document.getElementById('w-note').innerText = weights.note;
    }

    function resetMemory() {
        if(confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å­¸ç¿’è¨˜æ†¶å—ï¼Ÿ")) {
            weights = { family: 1, drug: 1, sci: 1, note: 1 };
            saveWeights();
            alert("è¨˜æ†¶å·²æ¸…é™¤ï¼");
        }
    }

    function fillPool() {
        questionPool = [];
        for(let i=0; i<db.length; i++) questionPool.push(i);
    }

    function updatePoolInfo() {
        const strategy = document.querySelector('input[name="strategy"]:checked').value;
        const info = document.getElementById('pool-info');
        if (strategy === 'once') {
            if (questionPool.length === 0 && count === 0) fillPool(); 
            info.innerText = `å‰©é¤˜é¡Œç›®ï¼š${questionPool.length}`;
        } else {
            info.innerText = "éš¨æ©ŸæŠ½å–æ¨¡å¼";
        }
    }

    function handleStrategyChange() {
        resetQuizState();
    }

    function setMode(mode, btn) {
        currentMode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        resetQuizState();
    }

    function resetQuizState() {
        score = 0; 
        count = 0; 
        wrongLog = [];
        sessionWrongIndices = []; // é‡ç½®éŒ¯é¡Œç´€éŒ„
        document.getElementById('score').innerText = 0;
        document.getElementById('count').innerText = 0;
        fillPool();
        updatePoolInfo();
        nextQuestion();
    }

    function getWeightedType() {
        let totalWeight = weights.family + weights.drug + weights.sci + weights.note;
        let randomNum = Math.random() * totalWeight;
        if (randomNum < weights.family) return 'family';
        randomNum -= weights.family;
        if (randomNum < weights.drug) return 'drug';
        randomNum -= weights.drug;
        if (randomNum < weights.sci) return 'sci';
        return 'note';
    }

    function nextQuestion() {
        canAnswer = true;
        document.getElementById('next-btn').style.display = 'none';
        
        const strategy = document.querySelector('input[name="strategy"]:checked').value;
        
        if (strategy === 'once') {
            if (questionPool.length === 0) {
                // å¦‚æœæ˜¯éŒ¯é¡Œè¤‡ç¿’æ¨¡å¼è·‘å®Œäº†
                alert("æ­å–œï¼æœ¬è¼ªé¡Œç›®ï¼ˆæˆ–éŒ¯é¡Œè¤‡ç¿’ï¼‰å·²å…¨éƒ¨å®Œæˆï¼");
                endQuiz(); // ç›´æ¥çµæŸ
                return;
            }
            let randPoolIdx = Math.floor(Math.random() * questionPool.length);
            currentDbIndex = questionPool[randPoolIdx];
            questionPool.splice(randPoolIdx, 1);
            updatePoolInfo();
        } else {
            currentDbIndex = Math.floor(Math.random() * db.length);
            updatePoolInfo();
        }

        const item = db[currentDbIndex];
        let type = currentMode;
        if (type === 'mix') type = getWeightedType();

        let qText = "", tagText = "";
        let correctAns = item[type];
        if (!correctAns) { type = 'family'; correctAns = item.family; }

        switch(type) {
            case 'family': qText = `ã€${item.name}ã€‘ å±¬æ–¼å“ªä¸€ç§‘ï¼Ÿ`; tagText = "ğŸŒ± è€ƒç§‘å"; break;
            case 'drug':   qText = `ã€${item.name}ã€‘ çš„ç”Ÿè—¥å (Latin) æ˜¯ï¼Ÿ`; tagText = "ğŸ’Š è€ƒç”Ÿè—¥å"; break;
            case 'sci':    qText = `ã€${item.name}ã€‘ çš„å­¸å (Scientific) æ˜¯ï¼Ÿ`; tagText = "ğŸ”¬ è€ƒå­¸å"; break;
            case 'note':   qText = `é—œæ–¼ã€${item.name}ã€‘ çš„ç‰¹å¾µ/å‚™è¨»ï¼Œä½•è€…æ­£ç¢ºï¼Ÿ`; tagText = "ğŸ“ è€ƒç‰¹å¾µ"; break;
        }

        currentQData = { question: qText, correct: correctAns, type: type };
        document.getElementById('q-tag').innerText = tagText;
        document.getElementById('question').innerText = qText;

        let options = [correctAns];
        let safetyLoop = 0;
        while(options.length < 4 && safetyLoop < 50) {
            let randomItem = db[Math.floor(Math.random() * db.length)];
            let otherAns = randomItem[type];
            if(otherAns && !options.includes(otherAns)) options.push(otherAns);
            safetyLoop++;
        }
        options.sort(() => Math.random() - 0.5);

        const area = document.getElementById('options-area');
        area.innerHTML = "";
        options.forEach(opt => {
            let btn = document.createElement("button");
            btn.className = "opt-btn";
            btn.innerText = opt;
            btn.onclick = function() { checkAnswer(this, opt, correctAns); };
            area.appendChild(btn);
        });
    }

    function checkAnswer(btn, myAns, correctAns) {
        if(!canAnswer) return;
        canAnswer = false;
        count++;
        
        const allBtns = document.querySelectorAll('.opt-btn');
        if (myAns === correctAns) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            allBtns.forEach(b => { if(b.innerText === correctAns) b.classList.add('correct'); });
            
            // ç´€éŒ„éŒ¯èª¤
            wrongLog.push({ q: currentQData.question, wrong: myAns, right: correctAns });
            // ç´€éŒ„è©²é¡Œçš„ DB Indexï¼Œä¾›è¤‡ç¿’ä½¿ç”¨
            if (!sessionWrongIndices.includes(currentDbIndex)) {
                sessionWrongIndices.push(currentDbIndex);
            }

            weights[currentQData.type] += 1;
            saveWeights();
        }
        
        document.getElementById('score').innerText = score;
        document.getElementById('count').innerText = count;
        document.getElementById('next-btn').style.display = 'inline-block';
    }

    function endQuiz() {
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('review-section').style.display = 'block';
        document.getElementById('final-score').innerText = `${score} / ${count}`;
        
        // é¡¯ç¤ºéŒ¯é¡Œè¤‡ç¿’æŒ‰éˆ•é‚è¼¯
        const reviewBtn = document.getElementById('review-wrong-btn');
        if (sessionWrongIndices.length > 0) {
            reviewBtn.style.display = 'block';
            reviewBtn.innerText = `ğŸ¯ ç«‹å³è¤‡ç¿’æœ¬è¼ªéŒ¯é¡Œ (${sessionWrongIndices.length} é¡Œ)`;
        } else {
            reviewBtn.style.display = 'none';
        }

        const list = document.getElementById('wrong-list');
        list.innerHTML = "";
        if(wrongLog.length === 0) {
            list.innerHTML = "<p style='text-align:center; color:#2e7d32;'>ğŸ‰ å¤ªå¼·äº†ï¼é€™è¼ªå…¨å°ï¼</p>";
        } else {
            wrongLog.forEach((item, index) => {
                let div = document.createElement('div');
                div.className = 'review-item';
                div.innerHTML = `<div class="review-q">${index+1}. ${item.q}</div><div class="review-wrong">âŒ ä½ çš„å›ç­”ï¼š${item.wrong}</div><div class="review-correct">âœ… æ­£ç¢ºç­”æ¡ˆï¼š${item.right}</div>`;
                list.appendChild(div);
            });
        }
    }

    // å•Ÿå‹•éŒ¯é¡Œè¤‡ç¿’æ¨¡å¼
    function startReviewWrong() {
        if (sessionWrongIndices.length === 0) return;

        // 1. å¼·åˆ¶åˆ‡æ›åˆ°ã€Œåœ°æ¯¯æ¨¡å¼ã€(once)
        const radios = document.getElementsByName('strategy');
        radios.forEach(r => { if(r.value === 'once') r.checked = true; });

        // 2. å°‡é¡Œç›®æ±  (questionPool) æ›¿æ›ç‚ºéŒ¯é¡Œ ID
        questionPool = [...sessionWrongIndices];
        
        // 3. é‡ç½®åˆ†æ•¸èˆ‡ç‹€æ…‹ï¼Œä½†ä¸é‡ç½® sessionWrongIndices (é¿å…è¤‡ç¿’åˆ°ä¸€åŠæŒ‰çµç®—åˆæ¶ˆå¤±)
        score = 0;
        count = 0;
        wrongLog = [];
        
        document.getElementById('score').innerText = 0;
        document.getElementById('count').innerText = 0;
        document.getElementById('pool-info').innerText = `ğŸ”¥ éŒ¯é¡Œç‰¹è¨“æ¨¡å¼ï¼šå‰©é¤˜ ${questionPool.length} é¡Œ`;

        // 4. åˆ‡æ›ç•«é¢
        document.getElementById('review-section').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';

        nextQuestion();
    }

    function restartQuiz() {
        document.getElementById('quiz-container').style.display = 'block';
        document.getElementById('review-section').style.display = 'none';
        resetQuizState();
    }

    initWeights();
    fillPool();
    updatePoolInfo();
    nextQuestion();
</script>
</body>
</html>
